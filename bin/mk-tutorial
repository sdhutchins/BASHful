#!/bin/bash
# ------------------------------------------------------------------
# [Shaurita D. Hutchins] create-tutorial
#          This script creates directory structure for tutorial folders.
#          Usage: create-tutorial <tutorial_name> <language (R or Python)>
# ------------------------------------------------------------------

set -euo pipefail

# Check if the correct number of arguments is provided
if [[ $# -ne 2 ]]; then
    echo "Usage: $(basename "$0") <tutorial_name> <language (R or Python)>"
    exit 1
fi

# Capture the arguments
TUTORIAL_NAME="$1"
LANGUAGE="$2"

# Create the main tutorial directory
mkdir -p "$TUTORIAL_NAME"

# Navigate into the directory
cd "$TUTORIAL_NAME" || exit

# Create necessary subdirectories
mkdir -p data output

# Create .gitkeep files in data and output folders
touch data/.gitkeep output/.gitkeep

# Create the README.md file with the tutorial name
echo "# $TUTORIAL_NAME" > README.md

# Create the test file and .gitignore based on the specified language
if [[ "$LANGUAGE" == "Python" ]]; then
    echo "print('Hello, this is a Python tutorial')" > test.py
    
    # Use heredoc with quoted delimiter 'EOF' to prevent variable expansion
    cat << 'EOF' > .gitignore
# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# C extensions
*.so

# Packages
*.egg
*.egg-info/
dist/
build/
.eggs/

# Virtual environments
.env
.venv
venv/
ENV/

# PyInstaller
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.nox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
*.py,cover

# Jupyter Notebook
.ipynb_checkpoints

# pyenv
.python-version

# mypy
.mypy_cache/
.dmypy.json
.dmypy.log
EOF

    {
        echo ""
        echo "# Command to create a virtual environment:"
        echo "python -m venv venv"
    } >> README.md

elif [[ "$LANGUAGE" == "R" ]]; then
    echo "print('Hello, this is an R tutorial')" > test.R
    
    cat << 'EOF' > .gitignore
# History files
.Rhistory
.Rapp.history

# Session Data files
.RData

# User-specific files
.Ruserdata

# Example code in package build process
*-Ex.R

# Output files from R CMD build
/*.tar.gz

# Output files from R CMD check
/*.Rcheck/

# RStudio files
.Rproj.user/
.Rproj.user
*.Rproj
.Rproj

# Produced vignettes
vignettes/*.html
vignettes/*.pdf

# OAuth2 token, see https://github.com/hadley/httr/releases/tag/v0.3
.httr-oauth

# Knitr and R markdown default cache directories
*_cache/

# Temporary files created by R markdown
*.utf8.md
*.knit.md

# R Environment Variables
Renviron
.Renviron
EOF

else
    echo "Unsupported language. Please specify 'Python' or 'R'."
    exit 1
fi

echo "Tutorial structure created successfully for $LANGUAGE."
